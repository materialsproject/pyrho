
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="ie=edge" http-equiv="x-ua-compatible"/>
<meta content="Library for analysis of periodic scalar field data" name="description"/>
<link href="../../assets/images/favicon.png" rel="shortcut icon"/>
<meta content="mkdocs-1.1, mkdocs-material-components-1.10.11" name="generator"/>
<title>core - pyRho</title>
<script src="../../assets/javascripts/modernizr-e826f8942a.js"></script>
<link href="../../assets/stylesheets/application-2cd7d9ab0f.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/material-components-web.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/mdc-web.css" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css?family=Open Sans:300,300i,400,400i,600,600i,700,700i,800,800i|Ubuntu+Mono" rel="stylesheet"/>
<style>body,input{font-family:"Open Sans","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Ubuntu Mono","Courier New",Courier,monospace}</style>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.20/jquery.fancybox.min.css" rel="stylesheet"/>
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.20/jquery.fancybox.min.js"></script>
</head>
<body>
<svg class="md-svg">
<defs>
<svg height="448" id="github" viewbox="0 0 416 448" width="416" xmlns="http://www.w3.org/2000/svg"><path d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z" fill="currentColor"></path></svg>
</defs>
</svg>
<input class="md-toggle" data-md-toggle="drawer" id="drawer" type="checkbox"/>
<input class="md-toggle" data-md-toggle="search" id="search" type="checkbox"/>
<label class="md-overlay" data-md-component="overlay" for="drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink md-flex__cell--vmiddle">
<a class="md-header-nav__button md-logo" href="" title="pyRho">
<img height="36" src="../../assets/images/logo_white.png" width="36"/>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<span class="md-flex__ellipsis md-header-nav__title">
          
            pyRho -
            
              
                <span class="md-header-nav__parent">
                  Reference
                </span>
              
            
            core
          
        </span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="search"></label>
<div class="md-search__inner">
<form class="md-search__form" name="search">
<input autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-icon md-search__icon" for="search"></label>
<button class="md-icon md-search__icon" data-md-component="reset" type="reset"></button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="result" data-md-lang-search="" data-md-lang-tokenizer="[\s\-]+">
<div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a class="md-source" data-md-source="github" href="https://github.com/jmmshn/pyRho/" title="Go to repository">
<div class="md-source__icon">
<svg height="24" viewbox="0 0 24 24" width="24">
<use height="24" width="24" xlink:href="#github"></use>
</svg>
</div>
<div class="md-source__repository">
      GitHub
    </div>
</a>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title md-nav__title--site" for="drawer">
<div class="md-nav__button md-logo">
<i class="md-icon md-icon--home"></i>
</div>
    pyRho
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-source="github" href="https://github.com/jmmshn/pyRho/" title="Go to repository">
<div class="md-source__icon">
<svg height="24" viewbox="0 0 24 24" width="24">
<use height="24" width="24" xlink:href="#github"></use>
</svg>
</div>
<div class="md-source__repository">
      GitHub
    </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="" title="Home">
      Home
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="concepts/" title="Core Concepts">
      Core Concepts
    </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" id="nav-3" type="checkbox"/>
<label class="md-nav__link" for="nav-3">
      Getting Started
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="1">
<label class="md-nav__title" for="nav-3">
        Getting Started
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="getting_started/jupyter_setup/" title="Jupyter Setup">
      Jupyter Setup
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-toggle md-nav__toggle" data-md-toggle="nav-4" id="nav-4" type="checkbox"/>
<label class="md-nav__link" for="nav-4">
      Reference
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="1">
<label class="md-nav__title" for="nav-4">
        Reference
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-toggle md-nav__toggle" data-md-toggle="toc" id="toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="toc">
        core
      </label>
<a class="md-nav__link md-nav__link--active" href="reference/core/" title="core">
      core
    </a>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title md-nav__toc" for="toc">Table of contents</label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#pyrho.core.pgrid" title="pyrho.core.pgrid">
    pyrho.core.pgrid
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pyrho.core.pgrid.PGrid" title="PGrid">
    PGrid
  </a>
<nav class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#pyrho.core.pgrid.PGrid.__init__" title="__init__()">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pyrho.core.pgrid.PGrid.gaussian_smear" title="gaussian_smear()">
    gaussian_smear()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pyrho.core.pgrid.PGrid.get_transformed_data" title="get_transformed_data()">
    get_transformed_data()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pyrho.core.pgrid.PGrid.get_transformed_obj" title="get_transformed_obj()">
    get_transformed_obj()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pyrho.core.pgrid.PGrid.lossy_smooth_compression" title="lossy_smooth_compression()">
    lossy_smooth_compression()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pyrho.core.chargeDensity" title="pyrho.core.chargeDensity">
    pyrho.core.chargeDensity
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pyrho.core.chargeDensity.ChargeDensity" title="ChargeDensity">
    ChargeDensity
  </a>
<nav class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#pyrho.core.chargeDensity.ChargeDensity.lattice" title="lattice">
    lattice
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pyrho.core.chargeDensity.ChargeDensity.rho" title="rho">
    rho
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pyrho.core.chargeDensity.ChargeDensity.__init__" title="__init__()">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pyrho.core.chargeDensity.ChargeDensity.get_reshaped_cell" title="get_reshaped_cell()">
    get_reshaped_cell()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pyrho.core.chargeDensity.ChargeDensity.reorient_axis" title="reorient_axis()">
    reorient_axis()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="reference/vis/" title="vis">
      vis
    </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title md-nav__toc" for="toc">Table of contents</label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#pyrho.core.pgrid" title="pyrho.core.pgrid">
    pyrho.core.pgrid
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pyrho.core.pgrid.PGrid" title="PGrid">
    PGrid
  </a>
<nav class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#pyrho.core.pgrid.PGrid.__init__" title="__init__()">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pyrho.core.pgrid.PGrid.gaussian_smear" title="gaussian_smear()">
    gaussian_smear()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pyrho.core.pgrid.PGrid.get_transformed_data" title="get_transformed_data()">
    get_transformed_data()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pyrho.core.pgrid.PGrid.get_transformed_obj" title="get_transformed_obj()">
    get_transformed_obj()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pyrho.core.pgrid.PGrid.lossy_smooth_compression" title="lossy_smooth_compression()">
    lossy_smooth_compression()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pyrho.core.chargeDensity" title="pyrho.core.chargeDensity">
    pyrho.core.chargeDensity
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pyrho.core.chargeDensity.ChargeDensity" title="ChargeDensity">
    ChargeDensity
  </a>
<nav class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#pyrho.core.chargeDensity.ChargeDensity.lattice" title="lattice">
    lattice
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pyrho.core.chargeDensity.ChargeDensity.rho" title="rho">
    rho
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pyrho.core.chargeDensity.ChargeDensity.__init__" title="__init__()">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pyrho.core.chargeDensity.ChargeDensity.get_reshaped_cell" title="get_reshaped_cell()">
    get_reshaped_cell()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pyrho.core.chargeDensity.ChargeDensity.reorient_axis" title="reorient_axis()">
    reorient_axis()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" id="article-content">
<article class="md-content__inner md-typeset">
<a class="md-icon md-content__icon" href="https://github.com/jmmshn/pyRho/edit/master/docs/reference/core.md" title="Edit this page"></a>
<h1>core</h1>
<div class="doc doc-object doc-module">
<h2 class="hidden-toc" href="#pyrho.core.pgrid" id="pyrho.core.pgrid" style="visibility: hidden; width: 0; height: 0;">
<a class="headerlink" href="#pyrho.core.pgrid" title="Permanent link">¶</a></h2>
<div class="doc doc-contents first">
<p>Python class for ND grid data volumetric data</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" id="pyrho.core.pgrid.PGrid">
<code>PGrid</code>
<a class="headerlink" href="#pyrho.core.pgrid.PGrid" title="Permanent link">¶</a></h2>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="pyrho.core.pgrid.PGrid.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid_data</span><span class="p">,</span> <span class="n">lattice</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#pyrho.core.pgrid.PGrid.__init__" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Base class for N-dimensional Regular period grid data.
The core code should be valid in N-dimensions and not depend on pymatgen</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>grid_data</code></td>
<td><code>ndarray</code></td>
<td>
<p>Data stored on the regular rid</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>lattice</code></td>
<td><code>Union[numpy.ndarray, List[List[float]]]</code></td>
<td>
<p>list of lattice vectors</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>pyrho/core/pgrid.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">grid_data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">lattice</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Base class for N-dimensional Regular period grid data.</span>
<span class="sd">    The core code should be valid in N-dimensions and not depend on pymatgen</span>

<span class="sd">    Args:</span>
<span class="sd">        grid_data: Data stored on the regular rid</span>
<span class="sd">        lattice: list of lattice vectors</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">lattice</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Some children will set the lattice</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lattice</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">grid_data</span> <span class="o">=</span> <span class="n">grid_data</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">grid_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_data</span><span class="o">.</span><span class="n">shape</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ngridpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_shape</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="pyrho.core.pgrid.PGrid.gaussian_smear">
<code class="highlight language-python">
gaussian_smear<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">arr_in</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#pyrho.core.pgrid.PGrid.gaussian_smear" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Applies an isotropic Gaussian smear of width (standard deviation) r to
the potential field. This is necessary to avoid finding paths through
narrow minima or nodes that may exist in the field (although any
potential or charge distribution generated from GGA should be
relatively smooth anyway). The smearing obeys periodic
boundary conditions at the edges of the cell.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>sigma</code></td>
<td><code>float</code></td>
<td>
<p>Smearing width in cartesian coordinates, in the same units as the</p>
</td>
<td><code>0.2</code></td>
</tr>
<tr>
<td><code>arr_in</code></td>
<td><code>ndarray</code></td>
<td>
<p>input data array to smear, if None: smear self.grid_data</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>pyrho/core/pgrid.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">gaussian_smear</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">sigma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">arr_in</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    Applies an isotropic Gaussian smear of width (standard deviation) r to</span>
<span class="sd">    the potential field. This is necessary to avoid finding paths through</span>
<span class="sd">    narrow minima or nodes that may exist in the field (although any</span>
<span class="sd">    potential or charge distribution generated from GGA should be</span>
<span class="sd">    relatively smooth anyway). The smearing obeys periodic</span>
<span class="sd">    boundary conditions at the edges of the cell.</span>

<span class="sd">    Args:</span>
<span class="sd">        sigma: Smearing width in cartesian coordinates, in the same units as the</span>
<span class="sd">        structure lattice vectors</span>
<span class="sd">        arr_in: input data array to smear, if None: smear self.grid_data</span>
<span class="sd">    """</span>
    <span class="c1"># get the dimension of the filter needed for 1 std dev of gaussian mask</span>
    <span class="c1"># Go 4 standard deviations away</span>
    <span class="k">if</span> <span class="n">arr_in</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_data</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">arr_in</span>
    <span class="n">r_frac</span> <span class="o">=</span> <span class="n">get_ucell_frac_fit_sphere</span><span class="p">(</span><span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">sigma</span> <span class="o">*</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">filter_shape</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nb">int</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">itr_rf</span> <span class="o">*</span> <span class="n">itr_dim</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="p">)</span>  <span class="c1"># dimension of the filter should be even</span>
        <span class="k">for</span> <span class="n">itr_rf</span><span class="p">,</span> <span class="n">itr_dim</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">r_frac</span><span class="p">,</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="n">filter_latt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">(</span><span class="n">filter_shape</span><span class="p">[</span><span class="n">_</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">_</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">[</span><span class="n">_</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dim</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># Get the fractional positions</span>
    <span class="n">filter_frac_c</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">filter_shape</span><span class="p">]</span>
    <span class="n">frac_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="o">*</span><span class="n">filter_frac_c</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">"ij"</span><span class="p">)</span>
    <span class="n">frac_pos</span> <span class="o">=</span> <span class="p">[</span><span class="n">_</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">frac_pos</span><span class="p">]</span>

    <span class="c1"># convert to cartesian</span>
    <span class="n">cart_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">filter_latt</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">frac_pos</span><span class="p">))</span>

    <span class="c1"># Distance the center if 1d we make  this iterable</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">filter_latt</span><span class="p">)</span>  <span class="c1"># type: Union[float, np.ndarray[float]]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">mid_point</span> <span class="o">=</span> <span class="n">tmp</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># type: Union[List, np.ndarray]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mid_point</span> <span class="o">=</span> <span class="p">[</span><span class="n">tmp</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">disp2mid2</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">i_coord</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">filter_shape</span><span class="p">)</span> <span class="o">-</span> <span class="n">mp_coord</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="k">for</span> <span class="n">mp_coord</span><span class="p">,</span> <span class="n">i_coord</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">mid_point</span><span class="p">,</span> <span class="n">cart_pos</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">dist2mid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">disp2mid2</span><span class="p">))</span>
    <span class="c1"># make sure the mask is zero?</span>
    <span class="n">mm</span> <span class="o">=</span> <span class="n">dist2mid</span> <span class="o">&lt;=</span> <span class="n">sigma</span> <span class="o">*</span> <span class="mi">4</span>
    <span class="n">gauss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">dist2mid</span> <span class="o">/</span> <span class="n">sigma</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">mm</span>
    <span class="n">gauss</span> <span class="o">=</span> <span class="n">gauss</span> <span class="o">/</span> <span class="n">gauss</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">convolve</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">arr</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">gauss</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"wrap"</span><span class="p">),</span> <span class="n">gauss</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="pyrho.core.pgrid.PGrid.get_transformed_data">
<code class="highlight language-python">
get_transformed_data<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sc_mat</span><span class="p">,</span> <span class="n">frac_shift</span><span class="p">,</span> <span class="n">grid_out</span><span class="p">)</span> </code>
<a class="headerlink" href="#pyrho.core.pgrid.PGrid.get_transformed_data" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Apply a transformation to the grid data
This function assumes that the data is fixed in place and the transformation
is applied to the lattice vectors.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>sc_mat</code></td>
<td><code>ndarray</code></td>
<td>
<p>matrix transformation applied to the lattice vectors</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>frac_shift</code></td>
<td><code>ndarray</code></td>
<td>
<p>shift the lattice in fractional coordinates of the output cell</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p>sc_mat  ---&gt;  [2, 1]    trans  ---&gt;  [0.1, 0.3]
              [0, 1]
new lattice vectors:
    a = [0.2, 0.4] --&gt; [2.2, 1.4]
    b = [0.2, 0.4] --&gt; [0.2, 1.1]</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ndarray</code></td>
<td>
<p>transformed data</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>pyrho/core/pgrid.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_transformed_data</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">sc_mat</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">frac_shift</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">grid_out</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    Apply a transformation to the grid data</span>
<span class="sd">    This function assumes that the data is fixed in place and the transformation</span>
<span class="sd">    is applied to the lattice vectors.</span>
<span class="sd">    Args:</span>
<span class="sd">        sc_mat: matrix transformation applied to the lattice vectors</span>
<span class="sd">        frac_shift: shift the lattice in fractional coordinates of the output cell</span>

<span class="sd">    sc_mat  ---&gt;  [2, 1]    trans  ---&gt;  [0.1, 0.3]</span>
<span class="sd">                  [0, 1]</span>
<span class="sd">    new lattice vectors:</span>
<span class="sd">        a = [0.2, 0.4] --&gt; [2.2, 1.4]</span>
<span class="sd">        b = [0.2, 0.4] --&gt; [0.2, 1.1]</span>

<span class="sd">    Returns:</span>
<span class="sd">        transformed data</span>

<span class="sd">    """</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">new_rho</span> <span class="o">=</span> <span class="n">get_sc_interp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_data</span><span class="p">,</span> <span class="n">sc_mat</span><span class="p">,</span> <span class="n">grid_sizes</span><span class="o">=</span><span class="n">grid_out</span><span class="p">)</span>
    <span class="n">new_rho</span> <span class="o">=</span> <span class="n">new_rho</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">grid_out</span><span class="p">)</span>

    <span class="n">grid_shifts</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nb">int</span><span class="p">(</span><span class="n">t</span> <span class="o">*</span> <span class="n">g</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">frac_shift</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">frac_shift</span><span class="p">),</span> <span class="n">grid_out</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="n">new_rho</span> <span class="o">=</span> <span class="n">roll_array</span><span class="p">(</span><span class="n">new_rho</span><span class="p">,</span> <span class="n">grid_shifts</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">new_rho</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="pyrho.core.pgrid.PGrid.get_transformed_obj">
<code class="highlight language-python">
get_transformed_obj<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sc_mat</span><span class="p">,</span> <span class="n">frac_shift</span><span class="p">,</span> <span class="n">grid_out</span><span class="p">)</span> </code>
<a class="headerlink" href="#pyrho.core.pgrid.PGrid.get_transformed_obj" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Get a new PGrid object for the new transformed data</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>sc_mat</code></td>
<td><code>ndarray</code></td>
<td>
<p>matrix transformation applied to the lattice vectors</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>frac_shift</code></td>
<td><code>List[float]</code></td>
<td>
<p>shift the lattice in fractional coordinates of the output cell</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>PGrid</code></td>
<td>
<p>New PGrid object</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>pyrho/core/pgrid.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>67
68
69
70
71
72
73
74
75
76
77
78
79
80
81</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_transformed_obj</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">sc_mat</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">frac_shift</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">grid_out</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"PGrid"</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    Get a new PGrid object for the new transformed data</span>
<span class="sd">    Args:</span>
<span class="sd">        sc_mat: matrix transformation applied to the lattice vectors</span>
<span class="sd">        frac_shift: shift the lattice in fractional coordinates of the output cell</span>

<span class="sd">    Returns:</span>
<span class="sd">        New PGrid object</span>
<span class="sd">    """</span>
    <span class="n">new_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_transformed_data</span><span class="p">(</span><span class="n">sc_mat</span><span class="p">,</span> <span class="n">frac_shift</span><span class="p">,</span> <span class="n">grid_out</span><span class="o">=</span><span class="n">grid_out</span><span class="p">)</span>
    <span class="n">new_lattice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">sc_mat</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">PGrid</span><span class="p">(</span><span class="n">grid_data</span><span class="o">=</span><span class="n">new_data</span><span class="p">,</span> <span class="n">lattice</span><span class="o">=</span><span class="n">new_lattice</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="pyrho.core.pgrid.PGrid.lossy_smooth_compression">
<code class="highlight language-python">
lossy_smooth_compression<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid_out</span><span class="p">,</span> <span class="n">smear_std</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span> </code>
<a class="headerlink" href="#pyrho.core.pgrid.PGrid.lossy_smooth_compression" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Perform Fourier interpolation then Gaussian smoothing.
the smoothing makes sure that simple operation like max and min filters still
give the same results.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>grid_out</code></td>
<td><code>List</code></td>
<td>
<p>desired output grid of the compressed data,</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ndarray</code></td>
<td>
<p>Smoothed array</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>pyrho/core/pgrid.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">lossy_smooth_compression</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">grid_out</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="n">smear_std</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    Perform Fourier interpolation then Gaussian smoothing.</span>
<span class="sd">    the smoothing makes sure that simple operation like max and min filters still</span>
<span class="sd">    give the same results.</span>

<span class="sd">    Args:</span>
<span class="sd">        grid_out: desired output grid of the compressed data,</span>

<span class="sd">    Returns:</span>
<span class="sd">        Smoothed array</span>
<span class="sd">    """</span>
    <span class="n">arr_interp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">interpolate_fourier</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_data</span><span class="p">,</span> <span class="n">grid_out</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">smear_std</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">arr_interp</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gaussian_smear</span><span class="p">(</span><span class="n">arr_in</span><span class="o">=</span><span class="n">arr_interp</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">smear_std</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">arr_interp</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="hidden-toc" href="#pyrho.core.chargeDensity" id="pyrho.core.chargeDensity" style="visibility: hidden; width: 0; height: 0;">
<a class="headerlink" href="#pyrho.core.chargeDensity" title="Permanent link">¶</a></h2>
<div class="doc doc-contents first">
<p>Main module.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" id="pyrho.core.chargeDensity.ChargeDensity">
<code>ChargeDensity</code>
<a class="headerlink" href="#pyrho.core.chargeDensity.ChargeDensity" title="Permanent link">¶</a></h2>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-attribute">
<h3 class="doc doc-heading" id="pyrho.core.chargeDensity.ChargeDensity.lattice">
<code class="highlight">
lattice: <span class="n">Lattice</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-property"><code>property</code></small>
<small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
</span>
<a class="headerlink" href="#pyrho.core.chargeDensity.ChargeDensity.lattice" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Override the lattice definition in PGrid</p>
</div>
</div>
<div class="doc doc-object doc-attribute">
<h3 class="doc doc-heading" id="pyrho.core.chargeDensity.ChargeDensity.rho">
<code class="highlight">
rho: <span class="n">ndarray</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-property"><code>property</code></small>
<small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
</span>
<a class="headerlink" href="#pyrho.core.chargeDensity.ChargeDensity.rho" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Alias for the grid data, which should be the true charge density</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="pyrho.core.chargeDensity.ChargeDensity.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid_data</span><span class="p">,</span> <span class="n">structure</span><span class="p">,</span> <span class="n">normalization</span><span class="o">=</span><span class="s1">'vasp'</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#pyrho.core.chargeDensity.ChargeDensity.__init__" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Class that contains functions to featurize volumetic data with periodic
boundary conditions.
Make sure the data being stored is grid-independent</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>grid_data</code></td>
<td><code>ndarray</code></td>
<td>
<p>Volumetric data to read in</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>structure</code></td>
<td><code>Structure</code></td>
<td>
<p>Atomic structure corresponding to the charge density</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>normalization</code></td>
<td><code>str</code></td>
<td>
<p>the normalization scheme:
- 'vasp' sum of the data / number of grid points == number of electrons</p>
</td>
<td><code>'vasp'</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>pyrho/core/chargeDensity.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">grid_data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span><span class="p">,</span> <span class="n">normalization</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"vasp"</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Class that contains functions to featurize volumetic data with periodic</span>
<span class="sd">    boundary conditions.</span>
<span class="sd">    Make sure the data being stored is grid-independent</span>

<span class="sd">    Args:</span>
<span class="sd">        grid_data: Volumetric data to read in</span>
<span class="sd">        structure: Atomic structure corresponding to the charge density</span>
<span class="sd">        normalization: the normalization scheme:</span>
<span class="sd">            - 'vasp' sum of the data / number of grid points == number of electrons</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">normalization</span> <span class="o">=</span> <span class="n">normalization</span>
    <span class="k">if</span> <span class="n">normalization</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">"n"</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        No rescaling</span>
<span class="sd">        """</span>
        <span class="n">scaled_data</span> <span class="o">=</span> <span class="n">grid_data</span>
    <span class="k">elif</span> <span class="n">normalization</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">"v"</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        the standard charge density from VASP is given as (rho*V) such that:</span>
<span class="sd">        sum(rho)/NGRID = NELECT/UC_vol</span>
<span class="sd">        so the real rho is:</span>
<span class="sd">        rho = (rho*UC_vol)*NGRID/UC_vol/UC_vol</span>
<span class="sd">        where the second V account for the different number of electrons in</span>
<span class="sd">        different cells</span>
<span class="sd">        """</span>
        <span class="n">scaled_data</span> <span class="o">=</span> <span class="n">grid_data</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">volume</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"Not a valid normalization scheme"</span><span class="p">)</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">grid_data</span><span class="o">=</span><span class="n">scaled_data</span><span class="p">,</span> <span class="n">lattice</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="pyrho.core.chargeDensity.ChargeDensity.get_reshaped_cell">
<code class="highlight language-python">
get_reshaped_cell<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sc_mat</span><span class="p">,</span> <span class="n">frac_shift</span><span class="p">,</span> <span class="n">new_grid</span><span class="o">=</span><span class="mi">1000000000</span><span class="p">)</span> </code>
<a class="headerlink" href="#pyrho.core.chargeDensity.ChargeDensity.get_reshaped_cell" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Motify the structure and data and return a new object containing the reshaped
data</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>sc_mat</code></td>
<td><code></code></td>
<td>
<p>Matrix to create the new cell</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>frac_shift</code></td>
<td><code></code></td>
<td>
<p>translation to be applied on the cell after the matrix</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>new_grid</code></td>
<td><code></code></td>
<td>
<p>density of the new grid, can also just take the desired</p>
</td>
<td><code>1000000000</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>pyrho/core/chargeDensity.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_reshaped_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sc_mat</span><span class="p">,</span> <span class="n">frac_shift</span><span class="p">,</span> <span class="n">new_grid</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">1e9</span><span class="p">)):</span>
    <span class="sd">"""</span>
<span class="sd">    Motify the structure and data and return a new object containing the reshaped</span>
<span class="sd">    data</span>
<span class="sd">    Args:</span>
<span class="sd">        sc_mat: Matrix to create the new cell</span>
<span class="sd">        frac_shift: translation to be applied on the cell after the matrix</span>
<span class="sd">        transformation</span>
<span class="sd">        new_grid: density of the new grid, can also just take the desired</span>
<span class="sd">        dimension as a list.</span>

<span class="sd">    Returns:</span>

<span class="sd">    """</span>
    <span class="n">new_structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">*</span> <span class="n">sc_mat</span>
    <span class="n">new_structure</span><span class="o">.</span><span class="n">translate_sites</span><span class="p">(</span>
        <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_structure</span><span class="p">))),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">frac_shift</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># determine the output grid</span>
    <span class="n">lengths</span> <span class="o">=</span> <span class="n">new_structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">abc</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_grid</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">ngrid</span> <span class="o">=</span> <span class="n">new_grid</span> <span class="o">/</span> <span class="n">new_structure</span><span class="o">.</span><span class="n">volume</span>
        <span class="n">mult</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span> <span class="o">/</span> <span class="n">ngrid</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">grid_out</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">l</span> <span class="o">/</span> <span class="n">mult</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lengths</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">grid_out</span> <span class="o">=</span> <span class="n">new_grid</span>

    <span class="n">new_rho</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_transformed_data</span><span class="p">(</span><span class="n">sc_mat</span><span class="p">,</span> <span class="n">frac_shift</span><span class="p">,</span> <span class="n">grid_out</span><span class="o">=</span><span class="n">grid_out</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_rho</span><span class="p">(</span><span class="n">new_rho</span><span class="p">,</span> <span class="n">new_structure</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalization</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="pyrho.core.chargeDensity.ChargeDensity.reorient_axis">
<code class="highlight language-python">
reorient_axis<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#pyrho.core.chargeDensity.ChargeDensity.reorient_axis" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Change the orgientation of the lattice vector so that:
a points along the x-axis, b is in the xy-plane, c is in the positive-z halve of space</p>
<details class="quote">
<summary>Source code in <code>pyrho/core/chargeDensity.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>102
103
104
105
106
107
108
109</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">reorient_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    Change the orgientation of the lattice vector so that:</span>
<span class="sd">    a points along the x-axis, b is in the xy-plane, c is in the positive-z halve of space</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">lattice</span> <span class="o">=</span> <span class="n">Lattice</span><span class="o">.</span><span class="n">from_parameters</span><span class="p">(</span>
        <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">abc</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">angles</span><span class="p">,</span> <span class="n">vesta</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a class="md-flex md-footer-nav__link md-footer-nav__link--prev" href="getting_started/jupyter_setup/" rel="prev" title="Jupyter Setup">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
                  Previous
                </span>
                Jupyter Setup
              </span>
</div>
</a>
<a class="md-flex md-footer-nav__link md-footer-nav__link--next" href="reference/vis/" rel="next" title="vis">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
                  Next
                </span>
                vis
              </span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
<div class="md-footer-copyright__highlight">
            Built by The Materials Project
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://yakworks.github.io/mkdocs-material-components/" title="Material Components for MkDocs">
          Material Components for MkDocs</a>
</div>
</div>
</div>
</footer>
</div>
<script src="../../assets/javascripts/application-68832431b5.js"></script>
<script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
<script>window.mdc.autoInit()</script>
<script src="../../assets/javascripts/headroom.min.js"></script>
<script src="../../assets/javascripts/jQuery.headroom.min.js"></script>
<script src="../../assets/javascripts/jq-mdc-web.js"></script>
<script src="https://cdn.jsdelivr.net/jquery.loadingoverlay/latest/loadingoverlay.min.js"></script>
<script>app.initialize({version:"1.1",url:{base:"../.."}})</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</body>
</html>